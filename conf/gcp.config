/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Google Cloud Batch Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration for running the pipeline on Google Cloud Batch.
    Requires GCP credentials and proper IAM roles to be configured.
----------------------------------------------------------------------------------------
*/

params {
    config_profile_name        = 'Google Cloud Batch'
    config_profile_description = 'Google Cloud Batch profile for gene2dis/mgap pipeline'
}

process {
    executor = 'google-batch'

    // GCP Batch specific settings
    withLabel:process_single {
        cpus         = 1
        memory       = 6.GB
        machineType  = 'n2-standard-2'
    }
    withLabel:process_low {
        cpus         = 2
        memory       = 12.GB
        machineType  = 'n2-standard-4'
    }
    withLabel:process_medium {
        cpus         = 6
        memory       = 36.GB
        machineType  = 'n2-standard-8'
    }
    withLabel:process_high {
        cpus         = 12
        memory       = 72.GB
        machineType  = 'n2-standard-16'
    }
    withLabel:process_long {
        time         = 16.h
    }
    withLabel:process_high_memory {
        memory       = 200.GB
        machineType  = 'n2-highmem-32'
    }
}

google {
    project = params.gcp_project ?: null
    region  = params.gcp_region  ?: 'us-central1'

    batch {
        spot = true
        bootDiskSize = 50.GB
    }

    lifeSciences {
        bootDiskSize = 50.GB
        preemptible  = true
    }
}

// Fusion filesystem for efficient GCS access
fusion {
    enabled = true
}

// Wave containers for on-demand container provisioning
wave {
    enabled = true
}

// Use Docker for GCP
docker {
    enabled   = true
    runOptions = '-u $(id -u):$(id -g)'
}
