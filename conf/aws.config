/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    AWS Batch Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration for running the pipeline on AWS Batch.
    Requires AWS credentials and proper IAM roles to be configured.
----------------------------------------------------------------------------------------
*/

params {
    config_profile_name        = 'AWS Batch'
    config_profile_description = 'AWS Batch profile for gene2dis/mgap pipeline'
}

process {
    executor = 'awsbatch'
    queue    = params.awsqueue ?: null

    // AWS Batch specific settings
    withLabel:process_single {
        cpus   = 1
        memory = 6.GB
    }
    withLabel:process_low {
        cpus   = 2
        memory = 12.GB
    }
    withLabel:process_medium {
        cpus   = 6
        memory = 36.GB
    }
    withLabel:process_high {
        cpus   = 12
        memory = 72.GB
    }
    withLabel:process_long {
        time   = 16.h
    }
    withLabel:process_high_memory {
        memory = 200.GB
    }
}

aws {
    region = params.awsregion ?: 'us-east-1'

    batch {
        cliPath       = '/home/ec2-user/miniconda/bin/aws'
        maxParallelTransfers = 8
        maxTransferAttempts  = 3
    }

    client {
        maxConnections = 20
        uploadMaxThreads = 8
        maxErrorRetry = 3
        socketTimeout = 3600000
        uploadRetrySleep = 100
    }
}

// Fusion filesystem for efficient S3 access
fusion {
    enabled = true
}

// Wave containers for on-demand container provisioning
wave {
    enabled = true
}

// Use Docker for AWS Batch
docker {
    enabled   = true
    runOptions = '-u $(id -u):$(id -g)'
}
