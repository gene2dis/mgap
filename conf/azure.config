/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Azure Batch Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration for running the pipeline on Azure Batch.
    Requires Azure credentials and proper permissions to be configured.
----------------------------------------------------------------------------------------
*/

params {
    config_profile_name        = 'Azure Batch'
    config_profile_description = 'Azure Batch profile for gene2dis/mgap pipeline'
}

process {
    executor = 'azurebatch'

    // Azure Batch specific settings
    withLabel:process_single {
        cpus   = 1
        memory = 6.GB
    }
    withLabel:process_low {
        cpus   = 2
        memory = 12.GB
    }
    withLabel:process_medium {
        cpus   = 6
        memory = 36.GB
    }
    withLabel:process_high {
        cpus   = 12
        memory = 72.GB
    }
    withLabel:process_long {
        time   = 16.h
    }
    withLabel:process_high_memory {
        memory = 200.GB
    }
}

azure {
    batch {
        location                = params.azure_location ?: 'eastus'
        accountName             = params.azure_batch_account ?: null
        autoPoolMode            = true
        allowPoolCreation       = true
        deletePoolsOnCompletion = true
        pools {
            auto {
                autoScale = true
                vmType    = 'Standard_D4_v3'
                vmCount   = 1
                maxVmCount = 10
            }
        }
    }
    storage {
        accountName   = params.azure_storage_account ?: null
        containerName = params.azure_storage_container ?: 'nf-workdir'
    }
}

// Fusion filesystem for efficient Azure Blob access
fusion {
    enabled = true
}

// Wave containers for on-demand container provisioning
wave {
    enabled = true
}

// Use Docker for Azure
docker {
    enabled   = true
    runOptions = '-u $(id -u):$(id -g)'
}
